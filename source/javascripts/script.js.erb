//= require '_ms.js.erb'
//= require '_changevalue.js.erb'
//= require '_panels.js.erb'
//= require '_form.js.erb'
//= require '_code.js.erb'
//= require '_error.js.erb'
//= require '_url.js.erb'
//= require '_typekit.js.erb'

// Vars
var mode = 'web';
var panel = 'form';
var outputMode = 'text';
var msBase = [1];
var msUnit = 'em';
var msRatio = [1.5];
var multiLimit = 3;

queryURL();

function stepUnits(u, msBase, msUnit, msRatio) {
  if (msUnit == 'em' && msBase == 1) {
    return (Math.round((ms(u,1,msRatio)[0])*1000)/1000)+'em';
  } else if (msBase.length > 1) {
    return (Math.round((ms(u,msBase,msRatio)[0])*1000)/1000)+msUnit;
  } else {
    return (Math.round((ms(u,msBase,msRatio)[0])*1000)/1000)+msUnit + ' / ' + (Math.round((ms(u,1,msRatio)[0])*1000)/1000)+'em';
  }
}

function msPage(msBase, msUnit, msRatio) {
  // upper bound of scale
  var u = 10;
  // lower bound of scale
  var l = -6;

  rMsUnit = msUnit;
  rMsBase = msBase;

  // This is a fix for ems not rendering smaller than a certan size.
  // This converts ems to px and allows the text to deisplay appropriately small.
  if (msUnit == 'em' || msUnit == 'rem') {
    rMsUnit = 'px';
    rMsBase = [];
    for (var i = 0; i < msBase.length; i++)
      rMsBase.push(msBase[i]*16);
  }


  while (u >= l) {

    var step = ms(u,rMsBase,msRatio);

    if (u >= 0) {
      document.getElementById('m'+u+'value').innerHTML=stepUnits(u, msBase, msUnit, msRatio);
      document.getElementById('text_m'+u).style.fontSize=(step[0]+rMsUnit);
      document.getElementById('text_m'+u).setAttribute('class', 's'+step[1]+' text');
    } else {
      document.getElementById('mn'+Math.abs(u)+'value').innerHTML=stepUnits(u, msBase, msUnit, msRatio);
      document.getElementById('text_mn'+Math.abs(u)).style.fontSize=(step[0]+rMsUnit);
      document.getElementById('text_mn'+Math.abs(u)).setAttribute('class', 's'+step[1]+' text');
    }

    u--;
  }
  document.getElementById('text_m0').scrollIntoView(false);
  newURL();
}

document.addEventListener('DOMContentLoaded', function(){
  document.getElementById('text_m0').scrollIntoView(false);
});


// If iOS web app
if (window.navigator.standalone && ( navigator.userAgent.match(/(iPad|iPhone|iPod)/g) ? true : false )) {
  document.body.classList.add('ios-webapp');
}